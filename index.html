<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üß†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
html, body { height: 100%; margin: 0; }
body {
  display: grid; place-items: center;
  background: #000; color: white;
  font-family: Arial, sans-serif; text-align: center;
}
#gameContainer {
  width: 90%; max-width: 700px; min-height: 520px;
  padding: 20px; background: #000; border-radius: 15px;
  box-shadow: 0 0 25px rgba(255,255,255,0.08);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
h1 { font-size: 1.8em; margin-bottom: 20px; color: #4dd0e1; font-family: 'Press Start 2P', cursive; }
#task, #wordDisplay { font-size: 1.4em; margin: 20px 0; min-height: 50px; font-family: 'Press Start 2P', cursive; }
#playerWord, #answer {
  width: 80%; max-width: 400px;
  padding: 10px; border-radius: 10px;
  border: none; text-align: center;
}
button {
  padding: 12px 25px;
  border-radius: 10px;
  background: #2e7d32;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover { background: #4caf50; }
#message { min-height: 40px; margin-top: 15px; }
#timer { margin-top: 10px; font-weight: bold; }

.timer-green{color:#4caf50}
.timer-yellow{color:#ffc107}
.timer-red{color:#f44336}

/* ‚ùì HELP BUTTON */
#helpBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  font-size:26px;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
  z-index:999;
}
#helpBtn:hover{color:#4dd0e1}

#helpModal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.75);
  z-index:1000;
}
#helpContent{
  background:#111;
  margin:15% auto;
  padding:20px;
  width:80%;
  max-width:400px;
  border-radius:12px;
}
#helpClose{
  float:right;
  cursor:pointer;
  font-size:22px;
}
</style>
</head>
<body>

<button id="helpBtn" onclick="toggleHelp()">‚ùì</button>

<div id="helpModal">
  <div id="helpContent">
    <span id="helpClose" onclick="toggleHelp()">‚úñ</span>
    <h3>üí° Help</h3>
    <p>
      ‚Ä¢ Word must start with last letter<br>
      ‚Ä¢ No repeats / no reversed words<br>
      ‚Ä¢ Beat AI to unlock next stage
    </p>
  </div>
</div>

<div id="gameContainer">
  <h1>üß†</h1>
  <button onclick="startWordChain()">START</button>
</div>

<script>
function toggleHelp(){
  const m=document.getElementById('helpModal');
  m.style.display = m.style.display==='block'?'none':'block';
}

/* ================= VARIABLES ================= */
let stage='start', wordScore=0;
let currentWord='', usedWords=[], wordList=[];
let board=[], gameOver=false;
let ticScore={player:0,ai:0,draw:0};
let timer=6, timerInterval;

/* ================= WORD CHAIN ================= */
function startWordChain(){
  stage='word';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="wordDisplay">Apple</div>
    <input id="playerWord" placeholder="Type word">
    <button onclick="playWord()">OK</button>
    <div id="message"></div>
  `;
  currentWord="Apple";
  usedWords=[currentWord];
  wordList=["Apple","Elephant","Tiger","Rabbit","Tree","Eagle","Egg","Giraffe"];
}

function playWord(){
  const i=document.getElementById('playerWord');
  let w=i.value.trim();
  if(!w) return;
  w=w[0].toUpperCase()+w.slice(1);
  if(w[0].toLowerCase()!==currentWord.slice(-1).toLowerCase()){
    document.getElementById('message').textContent="‚ùå Wrong!";
    return;
  }
  usedWords.push(w);
  currentWord=w;
  document.getElementById('wordDisplay').textContent=w;
  i.value='';
  setTimeout(aiTurn,500);
}

function aiTurn(){
  const last=currentWord.slice(-1).toLowerCase();
  const opts=wordList.filter(w=>w[0].toLowerCase()===last&&!usedWords.includes(w));
  if(!opts.length) return;
  const pick=opts[0];
  usedWords.push(pick);
  currentWord=pick;
  document.getElementById('wordDisplay').textContent=pick;
  wordScore++;
  if(wordScore>=6) setTimeout(startTicTacToe,700);
}

/* ================= TIC TAC TOE ================= */
function startTicTacToe(){
  stage='tic';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="board"></div>
    <div id="timer"></div>
    <div id="message"></div>
  `;
  board=['','','','','','','','',''];
  renderBoard();
  startTimer();
}

function renderBoard(){
  const b=document.getElementById('board');
  b.innerHTML='';
  b.style.display='grid';
  b.style.gridTemplateColumns='repeat(3,100px)';
  board.forEach((v,i)=>{
    const d=document.createElement('div');
    d.textContent=v;
    d.style.cssText="width:100px;height:100px;border:1px solid #555;font-size:40px;display:flex;align-items:center;justify-content:center;cursor:pointer";
    d.onclick=()=>playerMove(i);
    b.appendChild(d);
  });
}

function startTimer(){
  clearInterval(timerInterval);
  timer=6;
  updateTimer();
  timerInterval=setInterval(()=>{
    timer--;
    updateTimer();
    if(timer<=0){clearInterval(timerInterval); aiMove();}
  },1000);
}

function updateTimer(){
  document.getElementById('timer').textContent="‚è≥ "+timer;
}

function playerMove(i){
  if(board[i])return;
  board[i]='X';
  renderBoard();
  clearInterval(timerInterval);
  setTimeout(aiMove,400);
}

function aiMove(){
  const e=board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
  if(!e.length)return;
  board[e[0]]='O';
  renderBoard();
  startTimer();
}
  /* ========================== MATH CHALLENGE ========================== */
let correctAnswer=0, correctMathCount=0;
let mathTimer=30, mathTimerInterval;

function startMathChallenge(){
  stage='math';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="task"></div>
    <input id="answer" type="number" placeholder="Your answer">
    <button onclick="checkMathAnswer()">OK</button>
    <div id="timer"></div>
    <div id="message"></div>
  `;
  mathTimer=30;
  generateMathTask();
  startMathTimer();
}

function randomInt(min,max){
  return Math.floor(Math.random()*(max-min+1))+min;
}

function generateMathTask(){
  const a=randomInt(10,50);
  const b=randomInt(2,10);
  const c=randomInt(2,8);
  correctAnswer=a+b*c;
  document.getElementById('task').textContent=`${a} + ${b} √ó ${c} = ?`;
  document.getElementById('answer').value='';
}

function startMathTimer(){
  clearInterval(mathTimerInterval);
  document.getElementById('timer').textContent=`‚è≥ Time left: ${mathTimer}`;
  mathTimerInterval=setInterval(()=>{
    mathTimer--;
    const t=document.getElementById('timer');
    t.textContent=`‚è≥ Time left: ${mathTimer}`;
    t.className='';
    if(mathTimer>20)t.classList.add('timer-green');
    else if(mathTimer>10)t.classList.add('timer-yellow');
    else t.classList.add('timer-red');
    if(mathTimer<=0){
      clearInterval(mathTimerInterval);
      correctMathCount=0;
      restartGame();
    }
  },1000);
}

function checkMathAnswer(){
  const v=document.getElementById('answer').value;
  if(v==='') return;
  clearInterval(mathTimerInterval);
  if(Number(v)===correctAnswer){
    correctMathCount++;
    document.getElementById('message').textContent="‚úÖ Correct!";
    if(correctMathCount>=9){
      setTimeout(startChromaticTrial,700);
      return;
    }
    setTimeout(()=>{
      mathTimer=30;
      generateMathTask();
      startMathTimer();
    },700);
  }else{
    document.getElementById('message').textContent="‚ùå Wrong!";
    correctMathCount=0;
    setTimeout(restartGame,1000);
  }
}

/* ========================== CHROMATIC TRIAL ========================== */
const colorsCT=["#e57373","#64b5f6","#81c784","#fff176","#f44336","#ba68c8"];
const CHROMATIC_GOAL="#ba68c8";
let tilesCT=[], chromaticTime=60, chromaticTimerInterval, uniformTimeout=null, solved=false;

function startChromaticTrial(){
  stage='chromatic';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="grid"></div>
    <div id="timer"></div>
  `;
  createChromaticGrid();
  startChromaticTimer();
}

function createChromaticGrid(){
  const g=document.getElementById('grid');
  g.innerHTML='';
  g.style.display='grid';
  g.style.gridTemplateColumns='repeat(3,100px)';
  g.style.gap='12px';
  tilesCT=[];
  solved=false;

  for(let i=0;i<9;i++){
    const d=document.createElement('div');
    const idx=Math.floor(Math.random()*colorsCT.length);
    d.dataset.color=idx;
    d.style.background=colorsCT[idx];
    d.style.cssText+=`width:100px;height:100px;border-radius:15px;cursor:pointer`;
    d.onclick=()=>{
      cycleColor(d);
      checkWin();
      checkUniformReset();
    };
    tilesCT.push(d);
    g.appendChild(d);
  }
}

function cycleColor(tile){
  if(solved) return;
  let i=Number(tile.dataset.color);
  i=(i+1)%colorsCT.length;
  tile.dataset.color=i;
  tile.style.background=colorsCT[i];
}

function checkWin(){
  const win=tilesCT.every(t=>colorsCT[t.dataset.color]==CHROMATIC_GOAL);
  if(win && !solved){
    solved=true;
    clearInterval(chromaticTimerInterval);
    alert("ü´µ");
    setTimeout(restartGame,500);
  }
}

function checkUniformReset(){
  const f=colorsCT[tilesCT[0].dataset.color];
  const same=tilesCT.every(t=>colorsCT[t.dataset.color]==f);
  if(same && !solved){
    clearTimeout(uniformTimeout);
    uniformTimeout=setTimeout(startChromaticTrial,2000);
  }else clearTimeout(uniformTimeout);
}

function startChromaticTimer(){
  clearInterval(chromaticTimerInterval);
  chromaticTime=60;
  const t=document.getElementById('timer');
  t.textContent=`‚è≥ Time left: ${chromaticTime}`;
  chromaticTimerInterval=setInterval(()=>{
    chromaticTime--;
    t.textContent=`‚è≥ Time left: ${chromaticTime}`;
    t.className='';
    if(chromaticTime>30)t.classList.add('timer-green');
    else if(chromaticTime>10)t.classList.add('timer-yellow');
    else t.classList.add('timer-red');
    if(chromaticTime<=0){
      clearInterval(chromaticTimerInterval);
      clearTimeout(uniformTimeout);
      restartGame();
    }
  },1000);
}

/* ========================== RESTART ========================== */
function restartGame(){
  clearInterval(chromaticTimerInterval);
  clearInterval(mathTimerInterval);
  clearTimeout(uniformTimeout);

  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1>üß†</h1>
    <button onclick="startWordChain()">START</button>
  `;

  stage='start';
  wordScore=0;
  correctMathCount=0;
  board=[];
  usedWords=[];
}
</script>
</body>
</html>
